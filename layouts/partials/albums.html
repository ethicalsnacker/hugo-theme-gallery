{{ $scratch := newScratch }}
{{ $scratch.Set "albums" slice }}
{{ if .IsHome }}
  {{ $scratch.Add "albums" (where site.Pages.ByDate.Reverse "Params.featured" "=" true) }}
{{ end }}
{{ $scratch.Add "albums" (where .Pages.ByDate.Reverse "Params.private" "ne" true) }}


<div class="mt-8 mb-16 grid grid-cols-1 gap-x-6 gap-y-8 px-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 3xl:grid-cols-5">
  {{ range $scratch.Get "albums" | uniq }}
    {{ $images := .Resources.ByType "image" }}
    {{ if gt (len $images) 0 }}
      {{ $featured := ($images.GetMatch (.Params.featured_image | default "*feature*")) | default (index $images 0) }}
      {{ $thumbnail := $featured.Fill "900x600" }}
      {{ $color := index $thumbnail.Colors 0 | default "transparent" }}
      {{ $counts := partial "get_counts.html" . }}
      <a class="card card-compact group" href="{{ .RelPermalink }}" title="{{ .Title }}">
        <figure class="shadow-sm transition-all duration-300 group-hover:scale-[1.02] group-hover:shadow-lg">
          <img class="rounded-2xl lazyload aspect-[3/2] w-full" data-src="{{ $thumbnail.RelPermalink }}" alt="{{ .Title }}" />
        </figure>
        <div class="card-body">
          <h2 class="card-title">{{ .Title }}</h2>
          <p class="text-base-content/70">
            {{- i18n "photoCount" ($counts.images | lang.FormatNumber 0) }}
            {{ if gt $counts.albums 0 }}{{ i18n "in" }} {{ i18n "albumCount" ($counts.albums | lang.FormatNumber 0) }}{{ end -}}
          </p>
        </div>
      </a>
    {{ end }}
  {{ end }}
</div>
